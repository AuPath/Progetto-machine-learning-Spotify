\chapter{Dataset}
In questo capitolo viene analizzato il dataset. Viene quindi spiegato da dove è stato preso il dataset, descritte le covariate e viene effettuata un'analisi esplorativa.

\section{Acquisizione del dataset}
Il dataset completo contenente sia le informazioni sui singoli musicali che riguardo le varie certificazioni, ovvero le etichette del dataset, non è disponibile da una sola sorgente. Pertanto abbiamo ottenuto le informazioni necessarie da diversi sorgenti per poi integrare i dati.

\subsection{Dataset spotify - Kaggle}
Per quanto riguarda i brani con le relative informazioni e caratteristiche del brano, Spotify mette a disposizone un'API da cui si possono ottenere questi dati.

Con questa tecnica sono stati ottenuti i dati relativi ai brani, un utente ha quindi caricato il dataset sul sito \href{https://www.kaggle.com/}{kaggle.com}. Il dataset è disponibile su kaggle all'url indicato\footnote{\textbf{Dataset Spotify}: \href
	{https://www.kaggle.com/yamaerenay/spotify-dataset-19212020-160k-tracks}
	{https://www.kaggle.com/yamaerenay/spotify-dataset-19212020-160k-tracks}.}.

Il dataset contenente queste informazioni è il file: \verb|data/raw/to_integrate/data.csv|
\subsection{Premi canzoni - Wikipedia}
Le informazioni riguardo i premi delle canzoni, ovvero le varie certificazioni vinte, sono disponibili su \href{https://it.wikipedia.org//}{wikipedia.org}. Questa informazione costituisce di fatto l'etichetta per classificare ogni brano musicale.

Nello specifico siamo interessati a:
\begin{itemize}
	\item Singoli certificati oro
	\item Singoli certificati platino
	\begin{enumerate}
		\item Singoli certificati 1 volta platino
		\item Singoli certificati 2 volte platino
		\item ...
		\item Singoli certificati N volte platino
	\end{enumerate}
\end{itemize}

Inoltre le varie certificazioni dei singoli vengono considerati in base al paese. I paesi da noi presi in considerazione sono:
\begin{itemize}
	\item Italia
	\item Australia
	\item Stati Uniti d'America
	\item Regno Unito
	\item Canda
	\item Danimarca
\end{itemize}
Si noti come una certificazione può essere consegnata in diversi paesi alla stessa canzone.

\subsubsection{Certificazioni disco d'oro}
Per quanto riguarda i dischi d'oro, facciamo riferimento a questa pagina su wikipedia \footnote{\textbf{Disco d'oro per stato}:\\
	\href
	{https://it.wikipedia.org/wiki/Categoria:Singoli_certificati_oro_per_stato}
	{https://it.wikipedia.org/wiki/Categoria:Singoli\_certificati\_oro\_per\_stato}.}.
Fissato quindi uno stato (ad esempio l'Italia) è possibile visualizzare la pagina contenente la lista dei singoli che hanno vinto quel particolare premio. La lista è un elenco di url che puntano alla pagina wikipedia della canzone, un esempio a questo url\footnote{\textbf{Singoli certificati disco d'oro in Italia}:\\
	\href
	{https://it.wikipedia.org/wiki/Categoria:Singoli\_certificati\_disco\_d\%27oro_in_Italia}
	{https://it.wikipedia.org/wiki/Categoria:Singoli\_certificati\_disco\_d\%27oro\_in\_Italia}.}.

\subsubsection{Certificazioni disco di platino}
Ragionamento analogo viene fatto per i dischi di platino, con l'unica differenza che la pagina è questa\footnote{\textbf{Singoli certificati disco di platino per stato}:\\
	\href
	{https://it.wikipedia.org/wiki/Categoria:Singoli_certificati_platino_per_stato}
	{https://it.wikipedia.org/wiki/Categoria:Singoli\_certificati\_platino\_per\_stato}.}, inoltre
dal momento che i singoli posso vincere più volte un disco di platino, si considerano non solo i singoli che hanno vinto una volta il discho di platino ma anche quelli che l'hanno vinto N volte.

\subsubsection{Scraping}
Ottenuti quindi i puntatori alle canzoni certificate, è possibile accedere alla pagina wikipedia del singolo, la quale contiene una tabella riassuntiva della canzone. Un esempio di tabella viene mostrato nella Figura \ref{fig:wiki_table}.
\begin{figure}[H]
	\centering
	\includegraphics[width=12cm]{assets/wikipedia-table.png}
	\caption{Esempio di tabella per un singolo musicale su wikipedia}
	\label{fig:wiki_table}
\end{figure}

Viene quindi creato uno script per effettuare scraping delle tabelle, il codice è nella directory\\ \verb|scraping/wikipedia_songs_scraper.py|.

Successivamente si integrano le informazioni dei diversi stati, e tipi di certificazione vinti. Il risultato di questa operazione è il file \verb|data/raw/to_integrate/awards_cleaned.csv|.

\section{Descrizione del dataset}
In questa sezione vengono elencate e descritte le features del dataset. Trattandosi di un prolema supervisionato, ad ogni istanza viene associata la corretta etichetta, ovvero la classe positiva per i brani musicali che hanno vinto un premio e classe negativa per i brani che non hanno vinto un premio.
\subsection{Spotify}
\label{sec:descrizione_spotify}
Di seguito viene descritto il dataset proveniente da kaggle, ovvero quello contenente le informazioni dei brani.

\begin{center}
	
	\resizebox{\textwidth}{!}{
		\begin{tabular}[H]{ |l|l|l| }
			\hline
	
			\multicolumn{1}{ |c }{\textbf{ATTRIBUTO}} &
			\multicolumn{1}{ c }{\textbf{DESCRIZIONE}} &
			\multicolumn{1}{ c| }{ \textbf{TIPO}} \\
			
			\hline
			\hline
			
			id & 
			Identificativo della canzone (generato da spotify) &
			Intero\\
			
			name & 
			Titolo della canzone &
			Stringa\\
			
			artists & 
			Lista degli artisti che compaiono nel brano &
			Stringa\\
			
			year & 
			Anno del brano &
			Intero\\
			
			duration\_ms & 
			Durata della traccia in millisecondi &
			Intero\\
			
			acousticness & 
			Metrica riguardante quanto un brano risulta "acustico" &
			Float [0, 1]\\
			
			danceability & 
			Metrica riguardante quanto una traccia è ballabile &
			Float [0, 1]\\
			
			energy & 
			Energia del brano &
			Float [0, 1]\\
			
			instrumentalness & 
			Contenuto relativo di strumenti musicali nella traccia&
			Float [0, 1]\\
			
			valence & 
			Metrica riguardante la "positività" della traccia &
			Intero\\
			
			liveness & 
			Durata relativa della traccia suonata in una performance dal vivo &
			Float [0, 1]\\
			
			loudness & 
			Rumorosità della traccia in decibel (dB) &
			Float [-60, 0]\\
			
			release\_date & 
			Anno di rilascio del brano&
			Intero\\
			
			speechiness & 
			Contenuto relativo di voce umana nella traccia &
			Float [0, 1]\\
			
			tempo & 
			BPM della traccia &
			Float\\
			
			key & 
			Chiave musicale utilizzata &
			Factor \{0, 1, ..., 11\}\\
			
			mode & 
			Indica se la traccia parte con una progressione armonica &
			Booleano\\
			
			explicit & 
			Indica se la traccia è esplicita oppure no (linguaggio volgare) &
			Booleano\\
			
			popularity & 
			Popolarità della traccia &
			Float [0, 100]\\
			
			\hline
			
		\end{tabular}
	}
\end{center}



\subsection{Premi}
Si noti come la distinzione tra tipo di premio vinto e lo stato in cui è stata ottenuta la certificazione per uno specifico brano, viene fatta solo a scopo dello scraping, in quanto i brani sono così rappresentati sul sito di wikipedia. Tuttavia da questo punto in poi non verrà più tenuto conto di questa informazione, infatti un singolo verrà considerato come\textbf{ vincitore di un premio} (e quindi di successo) oppure come \textbf{non vincitore di un premio} (non di successo). 

Il risultato dello scraping della tabella di wikipedia è il seguente:


\begin{center}
	
	\resizebox{\textwidth}{!}{
		\begin{tabular}[H]{ |l|l|l| }
			\hline
			
			\multicolumn{1}{ |c }{\textbf{ATTRIBUTO}} &
			\multicolumn{1}{ c }{\textbf{DESCRIZIONE}} &
			\multicolumn{1}{ c| }{ \textbf{TIPO}} \\
			
			\hline
			\hline
			
			title & 
			Titolo della canzone &
			Stringa\\
			
			artists & 
			Artisti presenti nela traccia &
			Stringa\\
			
			date & 
			Data di rilascio della traccia &
			Data\\
			
			genre & 
			Genere musicale del brano&
			Stringa\\
			
			award & 
			Premio vinto dal singolo&
			Stringa \{Oro, 1\_platino, 2\_platino, ...\}\\
			
			nation & 
			Paese in cui è stato vinto il premio&
			Stringa (Sigla del paese)\\
			\hline
			
		\end{tabular}
	}
\end{center}

\section{Data integration}
Date queste due sorgenti dati, è necessario integrare i dati allo scopo di avere un dataset etichettato, le label saranno appunto se un bravo ha vinto un premio (quindi è di successo) oppure no.

La strategia di entity resolution adottata è considerare un singolo musicale come una singola identità basandosi sul titolo e gli artisti di una canzone. Se il nome del brano musicale è lo stesso e gli artisti coincidono, allora il brano è il medesimo.

\subsection{Record linkage con MongoDB}
A questo scopo i due dataset vengono importati in mongoDB, ogni istanza è rappresentata da un documento. Per la fase di record linkage vengono effettuati i seguenti passi:

\begin{enumerate}
	\item Import dei dataset in mongodb, inizialemnte in due collezioni diverse.
	\item Normalizzazione dei dati, i campi di join vengono trasformati in lowercase.
	\item Creazione indici.
	\item Entrambe le collezioni hanno il campo "artisti" il quale consiste in una stringa contenente la lista degli artisti separati dal carattere ",". Viene quindi eseguito l'unfold del campo "artista" in entrambe le collezioni, costruendo una lista di per ogni documento facendo uno split sul carattere ",".
	\item Viene eseguite la join sul campo titolo considerando un match valido se l'intersezione tra gli insiemi di artisti dei documenti delle due collezioni non è vuota.
	\item Viene ritrasformato il campo artista appiattendo la lista e rappresentando l'insieme degli artisti di un brano come una stringa, separando ogni artista con il carattere ",".
	\item Dump del database in un file .csv, questo è il dataset integrato e verrà usato per il training dei modelli.
\end{enumerate}



\section{Analisi esplorativa}
In questa sezione vengono analizzate e discusse le covariate del dataset.
\subsection{Assunzioni sul dominio}
\subsubsection{Anno di uscita singoli}
Viene per prima cosa analizzata la distribuzione degli anni di uscita nel dataset.

\begin{figure}[H]
	\centering
	\includegraphics[width=13cm]{../images/years_distribution.png}
	\caption{Distribuzione anno delle canozni considerando tutto il dataset.}
	\label{fig:year_distribution_all}
\end{figure}

Dal momento che Spotify è una piattaforma recente, si assume che gli utenti ascoltino maggiormente i brani usciti negli ultimi anni. Inoltre le diverse certificazioni come "Disco d'oro" e "Disco di platino" vengono rilasciate considerando il numero di streaming oltre che alle vendite solo da pochi anni. Inoltre con il passare del tempo i trend musicali cambiano, un fattore determinante per fare diventare una canzone di successo.

Con questa giustificazione si ritiene che sia meglio considerare solo i brani musicali dopo un certo anno di uscita. Prendiamo quindi in considerazione solo le canzoni dopo il 2005.

La distribuzione delle canzoni dal 2005 in poi è rappresentata in \autoref{fig:year_distribution_all}. Viene di seguito mostrato il boxplot delle canzoni dopo quella data distinguendo tra classe positiva e negativa, così da vedere se esistono differenze.

 \begin{figure}[H]
 	\centering
 	\includegraphics[width=13cm]{../images/year_award_comparison.png}
 	\caption{Boxplot anno di rilascio, distinguendo tra le classi.}
 \end{figure}
 
\subsubsection{Popolarità}
\label{sec:popularity}
Un altro apsetto che viene analizzato a parte, riguardo il quale è necessario fare ulteriori assunzioni, è il campo popolarità.

Il dataset forinto da Spotify contiene un campo "popularity". Tuttavia come spiegato nella \autoref{sec:successo}, questo campo non viene utilizzato per etichettare una canzone come di successo, si utilizza invece l'informazione delle certificazioni vinte da una canzone (ottenute da wikipedia).

Il campo "popularity" non verrà usato nella fase di training dei modelli, proprio perchè è un dato che non si conosce a priori nel momento in cui un singolo esce, ed è chiaramente influente nel determinare se una canzone vincerà o meno una certificazione e quindi se viene considerata di successo. 

Infatti l'informazione sulla popolarità viene calcolata sul numero di streaming dopo un determinato lasso di temo. Stimare questo valore, dal momento che non è conosciuto fin da subito, è di fatto un problema di regressione ed è molto simile al task di classificazione preso in esame, pertanto il campo viene scartato.

Anche se il campo non viene effettivamente utilizzato, è interessante analizzare la distribuzione dei valori di popolarità delle canzoni nel dataset. Inoltre assumiamo che per il problema trattato, si vogliono classificare delle canzoni che non sono completamente sconosciute. Sarebbe infatti irrealistico pensare che un singolo musicale del tutto sconosciuto vinca dal nulla una certificazione, risultando come brano di successo. 

Si assume di voler utilizzare questi modelli per classificare brani che iniziano ad essere un minimo conosciuti o hanno almeno il potenziale di diventare popolari. Si noti come un brano di poco popolare non implica assolutamente che questo vinca un disco d'oro o di platino.

Viene quindi qui sotto analizzata da distribuzione della popolarità delle canzoni nel dataset.


\begin{figure}[H]
	\centering
	\includegraphics[width=13cm]{../images/popularity_distribution.png}
	\caption{Distribuzione popolarità brani musicali.}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=13cm]{../images/popularity_boxplot.png}
\caption{Boxplot popolarità dei brani musicali.}
\end{figure}

Analizzando la distribuzione dei valori della popolarità si considerano il primo secondo e terzo quartile, rispettivamente: $q_{1/4} = 49; \; q_{2/4}= 57; \; q_{3/4} = 65$. Inoltre i valori di media e deviazione standard sono: $\mu = 57.83; \; \sigma = 10.12$.

Analizzando la distribuzione dei valori della popolarità viene scelto 25 come threshold, valore 3 volte più estremo della deviazione standard. Si considerano quindi solo i singoli con il valore "popularity" magggiore del threshold. In questo modo il dataset rispecchia l'assunzione sopra spiegata riguardo la popolarità minima, tuttavia si scartano solo i valori davvero estremi per non rendere questa assunzione troppo restrittiva.

\subsection{Distribuzione dei valori}
\subsubsection{Variabili numeriche}
Di seguito viene mostrata la distribuzione di tutte le covariate, distinguendo tra singoli che hanno vinto un premio (Classe positiva) e quelli che non hanno vinto un premio (Classe negativa).

\begin{figure}[H]
	\centering
	\includegraphics[width=19cm, angle=270]{../images/pairplot.png}
	\caption{Pairplot delle covariate.}
\end{figure}

Dal pairplot possiamo notare come non esiste una netta distinzione nei dati tra brani di successo e brani non di successo. Questo sarà sicuramente un problema in fase di classificazione e potrebbe potrare a basse performance dei modelli. Riteniamo quindi che sia necessario considerare altre features per ben distinguere brani musiclai di successo da quelli non di successo.

Il campo "popularity" ben distingue le due classi, tuttavia come già discusso in \autoref{sec:popularity}, questa covariata non verrà utilizzata per la creazione dei modelli.

Inoltre esiste correlazione tra alcune covariate, come ad esempio tra "energy" e "loudness", questo rispecchia intuitivamente l'idea di come una canzone più energica è anche più rumorosa. La correlazione tra le variabili viene meglio analizzata in \autoref{sec:correlazione}.

\subsubsection{Variabili categoriche}
Di seguito si esplorano le variabili categoriche del dataset, distinguendo tra classe positiva e negativa.

\begin{figure}[!h]

	\begin{subfigure}[b]{\textwidth}
		\centering
		\includegraphics[width=10cm]{../images/key_distribution.png}
		\caption{Variabile key.}
	\end{subfigure}
      
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
		\hspace*{-2cm}   
		\includegraphics[width=10cm]{../images/mode_distribution.png}
		\caption{Variabile mode.}
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.58\textwidth}
		\centering
		\includegraphics[width=10cm]{../images/explicit_distribution.png}
		\caption{Variabile explicit.}
	\end{subfigure}%
	\caption{Distribuzione delle variabili categoriche.}
\end{figure}

\subsection{Artisti nelle canzoni}
\subsubsection{Frequenza artisti}
\subsubsection{Wordcloud}


\subsection{Correlazione features}
\label{sec:correlazione}

\subsection{Principal component analysis}
Prima di PCA normalizzazione del dataset

NB: Non facciamo il plot delle prime due componenti principali in quanto varianza spiegata dalle prime due componenti molto bassa

\subsection{Creazione dataset bilanciato}
\subsubsection{Undersampling}


\section{Scelta delle features}

\subsection{Variabili scartate}

Vengono qui spiegate le features utilizzate
\subsection{Rappresentazione BOW degli artisti}
Artisti in lowercase e rappresentazione bow

Uso del threshold

\subsubsection{Threshold freqeunza}
Viene usato un threshold a 2 per non avere delle canzoni con artisti completamente sconosciuti. Assumiamo quindi di fare previsioni su canzoni cantante da artisti un minimo conosciuti.

Questa assunzione non è molto restrittiva, ci immaginiamo infatti che per vincere un premio una canzone deve essere cantata da artisti non completamente sconosciuti

Inoltre a causa dell'undersampling è possibile avere diverse canzoni cantate da artisti "sconosciuti" e non avendo scelto una particolare strategia per l'undersampling adottiamo a questo punto l'utilizzo di un threshold

\subsection{Variabili categoriche}
\subsubsection{Key - Trasformazione a intero}

\subsection{Coordinate PCA}
Dataset proiettato componenti principali

\subsection{Normalizzazione e standardizzazione}
Conversione in lowecase
Converto in variabili numeriche e factor + label corretta

\subsection{Dataset proiettato componenti principali}

\subsection{Riassunto feature finali utilizzate}
Tabella